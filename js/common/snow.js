var THREE=THREE||{};function randomRange(t,i){return Math.random()*(i-t)+t}self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),THREE.Color=function(t){return void 0!==t&&this.setHex(t),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t){return this.r=t.r*t.r,this.g=t.g*t.g,this.b=t.b*t.b,this},copyLinearToGamma:function(t){return this.r=Math.sqrt(t.r),this.g=Math.sqrt(t.g),this.b=Math.sqrt(t.b),this},setRGB:function(t,i,e){return this.r=t,this.g=i,this.b=e,this},setHSV:function(t,i,e){var n,o,r;if(0===e)this.r=this.g=this.b=0;else switch(n=Math.floor(6*t),o=6*t-n,t=e*(1-i),r=e*(1-i*o),i=e*(1-i*(1-o)),n){case 1:this.r=r,this.g=e,this.b=t;break;case 2:this.r=t,this.g=e,this.b=i;break;case 3:this.r=t,this.g=r,this.b=e;break;case 4:this.r=i,this.g=t,this.b=e;break;case 5:this.r=e,this.g=t,this.b=r;break;case 6:case 0:this.r=e,this.g=i,this.b=t}return this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},getHex:function(){return~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(t,i){this.x=t||0,this.y=i||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(t,i){return this.x=t,this.y=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x;return i*i+(t=this.y-t.y)*t},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t){return t.x===this.x&&t.y===this.y}},THREE.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiply:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideSelf:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t,this.z/=t):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},cross:function(t,i){return this.x=t.y*i.z-t.z*i.y,this.y=t.z*i.x-t.x*i.z,this.z=t.x*i.y-t.y*i.x,this},crossSelf:function(t){var i=this.x,e=this.y,n=this.z;return this.x=e*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-e*t.x,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){return(new THREE.Vector3).sub(this,t).lengthSq()},setPositionFromMatrix:function(t){this.x=t.n14,this.y=t.n24,this.z=t.n34},setRotationFromMatrix:function(t){var i=Math.cos(this.y);this.y=Math.asin(t.n13),1e-5<Math.abs(i)?(this.x=Math.atan2(-t.n23/i,t.n33/i),this.z=Math.atan2(-t.n12/i,t.n11/i)):(this.x=0,this.z=Math.atan2(t.n21,t.n22))},isZero:function(){return this.lengthSq()<1e-4}},THREE.Vector4=function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==n?n:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},lerpSelf:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}},THREE.Ray=function(c,l){function E(t,i,e){return w.sub(e,t),(n=w.dot(i))<=0?null:(o=M.add(t,b.copy(i).multiplyScalar(n)),e.distanceTo(o))}function p(t,i,e,n){return w.sub(n,i),M.sub(e,i),b.sub(t,i),r=w.dot(w),s=w.dot(M),a=w.dot(b),h=M.dot(M),y=M.dot(b),v=(r*y-s*a)*(x=1/(r*h-s*s)),0<=(H=(h*a-s*y)*x)&&0<=v&&H+v<1}this.origin=c||new THREE.Vector3,this.direction=l||new THREE.Vector3,this.intersectScene=function(t){return this.intersectObjects(t.children)},this.intersectObjects=function(t){var i,e,n=[];for(i=0,e=t.length;i<e;i++)Array.prototype.push.apply(n,this.intersectObject(t[i]));return n.sort(function(t,i){return t.distance-i.distance}),n};var u=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3,R=(c=new THREE.Vector3,l=new THREE.Vector3,new THREE.Vector3),T=new THREE.Vector3,g=new THREE.Vector3;this.intersectObject=function(t){for(var i,e=[],n=0,o=t.children.length;n<o;n++)Array.prototype.push.apply(e,this.intersectObject(t.children[n]));if(t instanceof THREE.Particle){if(null===(n=E(this.origin,this.direction,t.matrixWorld.getPosition()))||n>t.scale.x)return[];i={distance:n,point:t.position,face:null,object:t},e.push(i)}else if(t instanceof THREE.Mesh){if(null===(n=E(this.origin,this.direction,t.matrixWorld.getPosition()))||n>t.geometry.boundingSphere.radius*Math.max(t.scale.x,Math.max(t.scale.y,t.scale.z)))return e;var r,s,a=t.geometry,h=a.vertices;for(t.matrixRotationWorld.extractRotation(t.matrixWorld),n=0,o=a.faces.length;n<o;n++)i=a.faces[n],c.copy(this.origin),l.copy(this.direction),s=t.matrixWorld,(r=(R=s.multiplyVector3(R.copy(i.centroid)).subSelf(c)).dot(l))<=0||(u=s.multiplyVector3(u.copy(h[i.a].position)),d=s.multiplyVector3(d.copy(h[i.b].position)),f=s.multiplyVector3(f.copy(h[i.c].position)),i instanceof THREE.Face4&&(m=s.multiplyVector3(m.copy(h[i.d].position))),T=t.matrixRotationWorld.multiplyVector3(T.copy(i.normal)),r=l.dot(T),!t.doubleSided&&!(t.flipSided?0<r:r<0))||(r=T.dot(R.sub(u,c))/r,g.add(c,l.multiplyScalar(r)),i instanceof THREE.Face3?p(g,u,d,f)&&(i={distance:c.distanceTo(g),point:g.clone(),face:i,object:t},e.push(i)):i instanceof THREE.Face4&&(p(g,u,d,m)||p(g,d,f,m))&&(i={distance:c.distanceTo(g),point:g.clone(),face:i,object:t},e.push(i)))}return e};var n,o,r,s,a,h,y,x,H,v,w=new THREE.Vector3,M=new THREE.Vector3,b=new THREE.Vector3},THREE.Rectangle=function(){function s(){t=c-a,i=l-h}var a,h,c,l,t,i,E=!0;this.getX=function(){return a},this.getY=function(){return h},this.getWidth=function(){return t},this.getHeight=function(){return i},this.getLeft=function(){return a},this.getTop=function(){return h},this.getRight=function(){return c},this.getBottom=function(){return l},this.set=function(t,i,e,n){E=!1,a=t,h=i,c=e,l=n,s()},this.addPoint=function(t,i){E?(E=!1,c=a=t,l=h=i):(a=a<t?a:t,h=h<i?h:i,c=t<c?c:t,l=i<l?l:i),s()},this.add3Points=function(t,i,e,n,o,r){E?(E=!1,a=t<e?t<o?t:o:e<o?e:o,h=i<n?i<r?i:r:n<r?n:r,c=e<t?o<t?t:o:o<e?e:o,l=n<i?r<i?i:r:r<n?n:r):(a=t<e?t<o?t<a?t:a:o<a?o:a:e<o?e<a?e:a:o<a?o:a,h=i<n?i<r?i<h?i:h:r<h?r:h:n<r?n<h?n:h:r<h?r:h,c=e<t?o<t?c<t?t:c:c<o?o:c:o<e?c<e?e:c:c<o?o:c,l=n<i?r<i?l<i?i:l:l<r?r:l:r<n?l<n?n:l:l<r?r:l),s()},this.addRectangle=function(t){E?(E=!1,a=t.getLeft(),h=t.getTop(),c=t.getRight(),l=t.getBottom()):(a=a<t.getLeft()?a:t.getLeft(),h=h<t.getTop()?h:t.getTop(),c=c>t.getRight()?c:t.getRight(),l=l>t.getBottom()?l:t.getBottom()),s()},this.inflate=function(t){a-=t,h-=t,c+=t,l+=t,s()},this.minSelf=function(t){a=a>t.getLeft()?a:t.getLeft(),h=h>t.getTop()?h:t.getTop(),c=c<t.getRight()?c:t.getRight(),l=l<t.getBottom()?l:t.getBottom(),s()},this.intersects=function(t){return 0<=Math.min(c,t.getRight())-Math.max(a,t.getLeft())&&0<=Math.min(l,t.getBottom())-Math.max(h,t.getTop())},this.empty=function(){E=!0,l=c=h=a=0,s()},this.isEmpty=function(){return E}},THREE.Math={clamp:function(t,i,e){return t<i?i:e<t?e:t},clampBottom:function(t,i){return t<i?i:t},mapLinear:function(t,i,e,n,o){return n+(t-i)*(o-n)/(e-i)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var t,i=this.m;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},transposeIntoArray:function(t){var i=this.m;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}},THREE.Matrix4=function(t,i,e,n,o,r,s,a,h,c,l,E,p,u,d,f){this.set(void 0!==t?t:1,i||0,e||0,n||0,o||0,void 0!==r?r:1,s||0,a||0,h||0,c||0,void 0!==l?l:1,E||0,p||0,u||0,d||0,void 0!==f?f:1),this.flat=Array(16),this.m33=new THREE.Matrix3},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(t,i,e,n,o,r,s,a,h,c,l,E,p,u,d,f){return this.n11=t,this.n12=i,this.n13=e,this.n14=n,this.n21=o,this.n22=r,this.n23=s,this.n24=a,this.n31=h,this.n32=c,this.n33=l,this.n34=E,this.n41=p,this.n42=u,this.n43=d,this.n44=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.set(t.n11,t.n12,t.n13,t.n14,t.n21,t.n22,t.n23,t.n24,t.n31,t.n32,t.n33,t.n34,t.n41,t.n42,t.n43,t.n44),this},lookAt:function(t,i,e){var n=THREE.Matrix4.__v1,o=THREE.Matrix4.__v2,r=THREE.Matrix4.__v3;return r.sub(t,i).normalize(),0===r.length()&&(r.z=1),n.cross(e,r).normalize(),0===n.length()&&(r.x+=1e-4,n.cross(e,r).normalize()),o.cross(r,n).normalize(),this.n11=n.x,this.n12=o.x,this.n13=r.x,this.n21=n.y,this.n22=o.y,this.n23=r.y,this.n31=n.z,this.n32=o.z,this.n33=r.z,this},multiply:function(t,i){var e=t.n11,n=t.n12,o=t.n13,r=t.n14,s=t.n21,a=t.n22,h=t.n23,c=t.n24,l=t.n31,E=t.n32,p=t.n33,u=t.n34,d=t.n41,f=t.n42,m=t.n43,R=t.n44,T=i.n11,g=i.n12,y=i.n13,x=i.n14,H=i.n21,v=i.n22,w=i.n23,M=i.n24,b=i.n31,S=i.n32,z=i.n33,V=i.n34,C=i.n41,L=i.n42,j=i.n43,W=i.n44;return this.n11=e*T+n*H+o*b+r*C,this.n12=e*g+n*v+o*S+r*L,this.n13=e*y+n*w+o*z+r*j,this.n14=e*x+n*M+o*V+r*W,this.n21=s*T+a*H+h*b+c*C,this.n22=s*g+a*v+h*S+c*L,this.n23=s*y+a*w+h*z+c*j,this.n24=s*x+a*M+h*V+c*W,this.n31=l*T+E*H+p*b+u*C,this.n32=l*g+E*v+p*S+u*L,this.n33=l*y+E*w+p*z+u*j,this.n34=l*x+E*M+p*V+u*W,this.n41=d*T+f*H+m*b+R*C,this.n42=d*g+f*v+m*S+R*L,this.n43=d*y+f*w+m*z+R*j,this.n44=d*x+f*M+m*V+R*W,this},multiplySelf:function(t){return this.multiply(this,t)},multiplyToArray:function(t,i,e){return this.multiply(t,i),e[0]=this.n11,e[1]=this.n21,e[2]=this.n31,e[3]=this.n41,e[4]=this.n12,e[5]=this.n22,e[6]=this.n32,e[7]=this.n42,e[8]=this.n13,e[9]=this.n23,e[10]=this.n33,e[11]=this.n43,e[12]=this.n14,e[13]=this.n24,e[14]=this.n34,e[15]=this.n44,this},multiplyScalar:function(t){return this.n11*=t,this.n12*=t,this.n13*=t,this.n14*=t,this.n21*=t,this.n22*=t,this.n23*=t,this.n24*=t,this.n31*=t,this.n32*=t,this.n33*=t,this.n34*=t,this.n41*=t,this.n42*=t,this.n43*=t,this.n44*=t,this},multiplyVector3:function(t){var i=t.x,e=t.y,n=t.z,o=1/(this.n41*i+this.n42*e+this.n43*n+this.n44);return t.x=(this.n11*i+this.n12*e+this.n13*n+this.n14)*o,t.y=(this.n21*i+this.n22*e+this.n23*n+this.n24)*o,t.z=(this.n31*i+this.n32*e+this.n33*n+this.n34)*o,t},multiplyVector4:function(t){var i=t.x,e=t.y,n=t.z,o=t.w;return t.x=this.n11*i+this.n12*e+this.n13*n+this.n14*o,t.y=this.n21*i+this.n22*e+this.n23*n+this.n24*o,t.z=this.n31*i+this.n32*e+this.n33*n+this.n34*o,t.w=this.n41*i+this.n42*e+this.n43*n+this.n44*o,t},rotateAxis:function(t){var i=t.x,e=t.y,n=t.z;return t.x=i*this.n11+e*this.n12+n*this.n13,t.y=i*this.n21+e*this.n22+n*this.n23,t.z=i*this.n31+e*this.n32+n*this.n33,t.normalize(),t},crossVector:function(t){var i=new THREE.Vector4;return i.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w,i.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w,i.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w,i.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1,i},determinant:function(){var t=this.n11,i=this.n12,e=this.n13,n=this.n14,o=this.n21,r=this.n22,s=this.n23,a=this.n24,h=this.n31,c=this.n32,l=this.n33,E=this.n34,p=this.n41,u=this.n42,d=this.n43,f=this.n44;return n*s*c*p-e*a*c*p-n*r*l*p+i*a*l*p+e*r*E*p-i*s*E*p-n*s*h*u+e*a*h*u+n*o*l*u-t*a*l*u-e*o*E*u+t*s*E*u+n*r*h*d-i*a*h*d-n*o*c*d+t*a*c*d+i*o*E*d-t*r*E*d-e*r*h*f+i*s*h*f+e*o*c*f-t*s*c*f-i*o*l*f+t*r*l*f},transpose:function(){var t;return t=this.n21,this.n21=this.n12,this.n12=t,t=this.n31,this.n31=this.n13,this.n13=t,t=this.n32,this.n32=this.n23,this.n23=t,t=this.n41,this.n41=this.n14,this.n14=t,t=this.n42,this.n42=this.n24,this.n24=t,t=this.n43,this.n43=this.n34,this.n43=t,this},clone:function(){var t=new THREE.Matrix4;return t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(t){return t[0]=this.n11,t[1]=this.n21,t[2]=this.n31,t[3]=this.n41,t[4]=this.n12,t[5]=this.n22,t[6]=this.n32,t[7]=this.n42,t[8]=this.n13,t[9]=this.n23,t[10]=this.n33,t[11]=this.n43,t[12]=this.n14,t[13]=this.n24,t[14]=this.n34,t[15]=this.n44,t},flattenToArrayOffset:function(t,i){return t[i]=this.n11,t[i+1]=this.n21,t[i+2]=this.n31,t[i+3]=this.n41,t[i+4]=this.n12,t[i+5]=this.n22,t[i+6]=this.n32,t[i+7]=this.n42,t[i+8]=this.n13,t[i+9]=this.n23,t[i+10]=this.n33,t[i+11]=this.n43,t[i+12]=this.n14,t[i+13]=this.n24,t[i+14]=this.n34,t[i+15]=this.n44,t},setTranslation:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this},setScale:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this},setRotationX:function(t){var i=Math.cos(t);t=Math.sin(t);return this.set(1,0,0,0,0,i,-t,0,0,t,i,0,0,0,0,1),this},setRotationY:function(t){var i=Math.cos(t);t=Math.sin(t);return this.set(i,0,t,0,0,1,0,0,-t,0,i,0,0,0,0,1),this},setRotationZ:function(t){var i=Math.cos(t);t=Math.sin(t);return this.set(i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(t,i){var e=Math.cos(i),n=Math.sin(i),o=1-e,r=t.x,s=t.y,a=t.z,h=o*r,c=o*s;return this.set(h*r+e,h*s-n*a,h*a+n*s,0,h*s+n*a,c*s+e,c*a-n*r,0,h*a-n*s,c*a+n*r,o*a*a+e,0,0,0,0,1),this},setPosition:function(t){return this.n14=t.x,this.n24=t.y,this.n34=t.z,this},getPosition:function(){return THREE.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return THREE.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return THREE.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return THREE.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(t){var i=t.n11,e=t.n12,n=t.n13,o=t.n14,r=t.n21,s=t.n22,a=t.n23,h=t.n24,c=t.n31,l=t.n32,E=t.n33,p=t.n34,u=t.n41,d=t.n42,f=t.n43,m=t.n44;return this.n11=a*p*d-h*E*d+h*l*f-s*p*f-a*l*m+s*E*m,this.n12=o*E*d-n*p*d-o*l*f+e*p*f+n*l*m-e*E*m,this.n13=n*h*d-o*a*d+o*s*f-e*h*f-n*s*m+e*a*m,this.n14=o*a*l-n*h*l-o*s*E+e*h*E+n*s*p-e*a*p,this.n21=h*E*u-a*p*u-h*c*f+r*p*f+a*c*m-r*E*m,this.n22=n*p*u-o*E*u+o*c*f-i*p*f-n*c*m+i*E*m,this.n23=o*a*u-n*h*u-o*r*f+i*h*f+n*r*m-i*a*m,this.n24=n*h*c-o*a*c+o*r*E-i*h*E-n*r*p+i*a*p,this.n31=s*p*u-h*l*u+h*c*d-r*p*d-s*c*m+r*l*m,this.n32=o*l*u-e*p*u-o*c*d+i*p*d+e*c*m-i*l*m,this.n33=n*h*u-o*s*u+o*r*d-i*h*d-e*r*m+i*s*m,this.n34=o*s*c-e*h*c-o*r*l+i*h*l+e*r*p-i*s*p,this.n41=a*l*u-s*E*u-a*c*d+r*E*d+s*c*f-r*l*f,this.n42=e*E*u-n*l*u+n*c*d-i*E*d-e*c*f+i*l*f,this.n43=n*s*u-e*a*u-n*r*d+i*a*d+e*r*f-i*s*f,this.n44=e*a*c-n*s*c+n*r*l-i*a*l-e*r*E+i*s*E,this.multiplyScalar(1/t.determinant()),this},setRotationFromEuler:function(t,i){var e=t.x,n=t.y,o=t.z,r=Math.cos(e),s=(e=Math.sin(e),Math.cos(n)),a=(n=Math.sin(n),Math.cos(o));o=Math.sin(o);switch(i){case"YXZ":var h=s*a,c=s*o,l=n*a,E=n*o;this.n11=h+E*e,this.n12=l*e-c,this.n13=r*n,this.n21=r*o,this.n22=r*a,this.n23=-e,this.n31=c*e-l,this.n32=E+h*e,this.n33=r*s;break;case"ZXY":h=s*a,c=s*o,l=n*a,E=n*o,this.n11=h-E*e,this.n12=-r*o,this.n13=l+c*e,this.n21=c+l*e,this.n22=r*a,this.n23=E-h*e,this.n31=-r*n,this.n32=e,this.n33=r*s;break;case"ZYX":h=r*a,c=r*o,l=e*a,E=e*o,this.n11=s*a,this.n12=l*n-c,this.n13=h*n+E,this.n21=s*o,this.n22=E*n+h,this.n23=c*n-l,this.n31=-n,this.n32=e*s,this.n33=r*s;break;case"YZX":h=r*s,c=r*n,l=e*s,E=e*n,this.n11=s*a,this.n12=E-h*o,this.n13=l*o+c,this.n21=o,this.n22=r*a,this.n23=-e*a,this.n31=-n*a,this.n32=c*o+l,this.n33=h-E*o;break;case"XZY":h=r*s,c=r*n,l=e*s,E=e*n,this.n11=s*a,this.n12=-o,this.n13=n*a,this.n21=h*o+E,this.n22=r*a,this.n23=c*o-l,this.n31=l*o-c,this.n32=e*a,this.n33=E*o+h;break;default:h=r*a,c=r*o,l=e*a,E=e*o,this.n11=s*a,this.n12=-s*o,this.n13=n,this.n21=c+l*n,this.n22=h-E*n,this.n23=-e*s,this.n31=E-h*n,this.n32=l+c*n,this.n33=r*s}return this},setRotationFromQuaternion:function(t){var i=t.x,e=t.y,n=t.z,o=t.w,r=i+i,s=e+e,a=n+n,h=(t=i*r,i*s);i*=a;var c=e*s;return e*=a,n*=a,r*=o,s*=o,o*=a,this.n11=1-(c+n),this.n12=h-o,this.n13=i+s,this.n21=h+o,this.n22=1-(t+n),this.n23=e-r,this.n31=i-s,this.n32=e+r,this.n33=1-(t+c),this},scale:function(t){var i=t.x,e=t.y;t=t.z;return this.n11*=i,this.n12*=e,this.n13*=t,this.n21*=i,this.n22*=e,this.n23*=t,this.n31*=i,this.n32*=e,this.n33*=t,this.n41*=i,this.n42*=e,this.n43*=t,this},compose:function(t,i,e){var n=THREE.Matrix4.__m1,o=THREE.Matrix4.__m2;return n.identity(),n.setRotationFromQuaternion(i),o.setScale(e.x,e.y,e.z),this.multiply(n,o),this.n14=t.x,this.n24=t.y,this.n34=t.z,this},decompose:function(t,i,e){var n=THREE.Matrix4.__v1,o=THREE.Matrix4.__v2,r=THREE.Matrix4.__v3;return n.set(this.n11,this.n21,this.n31),o.set(this.n12,this.n22,this.n32),r.set(this.n13,this.n23,this.n33),t=t instanceof THREE.Vector3?t:new THREE.Vector3,i=i instanceof THREE.Quaternion?i:new THREE.Quaternion,(e=e instanceof THREE.Vector3?e:new THREE.Vector3).x=n.length(),e.y=o.length(),e.z=r.length(),t.x=this.n14,t.y=this.n24,t.z=this.n34,(n=THREE.Matrix4.__m1).copy(this),n.n11/=e.x,n.n21/=e.x,n.n31/=e.x,n.n12/=e.y,n.n22/=e.y,n.n32/=e.y,n.n13/=e.z,n.n23/=e.z,n.n33/=e.z,i.setFromRotationMatrix(n),[t,i,e]},extractPosition:function(t){return this.n14=t.n14,this.n24=t.n24,this.n34=t.n34,this},extractRotation:function(t){var i=1/(n=THREE.Matrix4.__v1).set(t.n11,t.n21,t.n31).length(),e=1/n.set(t.n12,t.n22,t.n32).length(),n=1/n.set(t.n13,t.n23,t.n33).length();return this.n11=t.n11*i,this.n21=t.n21*i,this.n31=t.n31*i,this.n12=t.n12*e,this.n22=t.n22*e,this.n32=t.n32*e,this.n13=t.n13*n,this.n23=t.n23*n,this.n33=t.n33*n,this}},THREE.Matrix4.makeInvert3x3=function(t){var i=t.m33,e=i.m,n=t.n33*t.n22-t.n32*t.n23,o=-t.n33*t.n21+t.n31*t.n23,r=t.n32*t.n21-t.n31*t.n22,s=-t.n33*t.n12+t.n32*t.n13,a=t.n33*t.n11-t.n31*t.n13,h=-t.n32*t.n11+t.n31*t.n12,c=t.n23*t.n12-t.n22*t.n13,l=-t.n23*t.n11+t.n21*t.n13,E=t.n22*t.n11-t.n21*t.n12;return 0===(t=t.n11*n+t.n21*s+t.n31*c)&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible."),t=1/t,e[0]=t*n,e[1]=t*o,e[2]=t*r,e[3]=t*s,e[4]=t*a,e[5]=t*h,e[6]=t*c,e[7]=t*l,e[8]=t*E,i},THREE.Matrix4.makeFrustum=function(t,i,e,n,o,r){var s;return(s=new THREE.Matrix4).n11=2*o/(i-t),s.n12=0,s.n13=(i+t)/(i-t),s.n14=0,s.n21=0,s.n22=2*o/(n-e),s.n23=(n+e)/(n-e),s.n24=0,s.n31=0,s.n32=0,s.n33=-(r+o)/(r-o),s.n34=-2*r*o/(r-o),s.n41=0,s.n42=0,s.n43=-1,s.n44=0,s},THREE.Matrix4.makePerspective=function(t,i,e,n){var o;return o=-(t=e*Math.tan(t*Math.PI/360)),THREE.Matrix4.makeFrustum(o*i,t*i,o,t,e,n)},THREE.Matrix4.makeOrtho=function(t,i,e,n,o,r){var s,a,h,c;return a=i-t,h=e-n,c=r-o,(s=new THREE.Matrix4).n11=2/a,s.n12=0,s.n13=0,s.n14=-(i+t)/a,s.n21=0,s.n22=2/h,s.n23=0,s.n24=-(e+n)/h,s.n31=0,s.n32=0,s.n33=-2/c,s.n34=-(r+o)/c,s.n41=0,s.n42=0,s.n43=0,s.n44=1,s},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.name="",this.id=THREE.Object3DCount++,this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=this.dynamic=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(t,i){this.matrix.rotateAxis(i),this.position.addSelf(i.multiplyScalar(t))},translateX:function(t){this.translate(t,this._vector.set(1,0,0))},translateY:function(t){this.translate(t,this._vector.set(0,1,0))},translateZ:function(t){this.translate(t,this._vector.set(0,0,1))},lookAt:function(t){this.matrix.lookAt(t,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(t){if(-1===this.children.indexOf(t)){void 0!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof THREE.Scene&&i.addObject(t)}},remove:function(t){var i=this.children.indexOf(t);if(-1!==i){for(t.parent=void 0,this.children.splice(i,1),i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof THREE.Scene&&i.removeObject(t)}},getChildByName:function(t,i){var e,n,o;for(e=0,n=this.children.length;e<n;e++){if((o=this.children[e]).name===t)return o;if(i&&void 0!==(o=o.getChildByName(t,i)))return o}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var i=0,e=this.children.length;i<e;i++)this.children[i].updateMatrixWorld(t)}},THREE.Object3DCount=0,THREE.Projector=function(){function s(){var t=i[e]=i[e]||new THREE.RenderableObject;return e++,t}function V(){var t=N[j]=N[j]||new THREE.RenderableVertex;return j++,t}function C(t,i){return i.z-t.z}var a,e,L,j,W,P,A,B,O,D,F,i=[],N=[],_=[],I=[],k=[],Y=[],U={objects:[],sprites:[],lights:[],elements:[]},h=new THREE.Vector3,q=new THREE.Vector4,X=new THREE.Matrix4,G=new THREE.Matrix4,c=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Z=new THREE.Vector4,Q=new THREE.Vector4;this.computeFrustum=function(t){for(c[0].set(t.n41-t.n11,t.n42-t.n12,t.n43-t.n13,t.n44-t.n14),c[1].set(t.n41+t.n11,t.n42+t.n12,t.n43+t.n13,t.n44+t.n14),c[2].set(t.n41+t.n21,t.n42+t.n22,t.n43+t.n23,t.n44+t.n24),c[3].set(t.n41-t.n21,t.n42-t.n22,t.n43-t.n23,t.n44-t.n24),c[4].set(t.n41-t.n31,t.n42-t.n32,t.n43-t.n33,t.n44-t.n34),c[5].set(t.n41+t.n31,t.n42+t.n32,t.n43+t.n33,t.n44+t.n34),t=0;t<6;t++){var i=c[t];i.divideScalar(Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z))}},this.projectVector=function(t,i){return i.matrixWorldInverse.getInverse(i.matrixWorld),X.multiply(i.projectionMatrix,i.matrixWorldInverse),X.multiplyVector3(t),t},this.unprojectVector=function(t,i){return i.projectionMatrixInverse.getInverse(i.projectionMatrix),X.multiply(i.matrixWorld,i.projectionMatrixInverse),X.multiplyVector3(t),t},this.pickingRay=function(t,i){var e;return t.z=-1,e=new THREE.Vector3(t.x,t.y,1),this.unprojectVector(t,i),this.unprojectVector(e,i),e.subSelf(t).normalize(),new THREE.Ray(t,e)},this.projectGraph=function(t,i){e=0,U.objects.length=0,U.sprites.length=0,U.lights.length=0;var r=function(t){if(!1!==t.visible){var i;if((i=t instanceof THREE.Mesh||t instanceof THREE.Line)&&!(i=!1===t.frustumCulled))t:{for(var e=t.matrixWorld,n=-t.geometry.boundingSphere.radius*Math.max(t.scale.x,Math.max(t.scale.y,t.scale.z)),o=0;o<6;o++)if((i=c[o].x*e.n14+c[o].y*e.n24+c[o].z*e.n34+c[o].w)<=n){i=!1;break t}i=!0}for(i?(X.multiplyVector3(h.copy(t.position)),(a=s()).object=t,a.z=h.z,U.objects.push(a)):t instanceof THREE.Sprite||t instanceof THREE.Particle?(X.multiplyVector3(h.copy(t.position)),(a=s()).object=t,a.z=h.z,U.sprites.push(a)):t instanceof THREE.Light&&U.lights.push(t),i=0,e=t.children.length;i<e;i++)r(t.children[i])}};return r(t),i&&U.objects.sort(C),U},this.projectScene=function(t,i,e){var n,o,r,s,a,h,c,l,E,p,u,d,f,m,R,T,g,y,x,H,v,w,M,b,S=i.near,z=i.far;for(F=O=A=P=0,void(U.elements.length=0)===i.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),t.add(i)),t.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),X.multiply(i.projectionMatrix,i.matrixWorldInverse),this.computeFrustum(X),U=this.projectGraph(t,!1),t=0,n=U.objects.length;t<n;t++)if(p=(E=U.objects[t].object).matrixWorld,d=E.material,j=0,E instanceof THREE.Mesh){for(u=E.geometry,f=E.geometry.materials,s=u.vertices,m=u.faces,R=u.faceVertexUvs,u=E.matrixRotationWorld.extractRotation(p),o=0,r=s.length;o<r;o++)(L=V()).positionWorld.copy(s[o].position),p.multiplyVector3(L.positionWorld),L.positionScreen.copy(L.positionWorld),X.multiplyVector4(L.positionScreen),L.positionScreen.x/=L.positionScreen.w,L.positionScreen.y/=L.positionScreen.w,L.visible=L.positionScreen.z>S&&L.positionScreen.z<z;for(s=0,o=m.length;s<o;s++){if((r=m[s])instanceof THREE.Face3){if(a=N[r.a],h=N[r.b],c=N[r.c],!(a.visible&&h.visible&&c.visible)||!E.doubleSided&&E.flipSided==(c.positionScreen.x-a.positionScreen.x)*(h.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(h.positionScreen.x-a.positionScreen.x)<0)continue;l=_[P]=_[P]||new THREE.RenderableFace3,P++,(W=l).v1.copy(a),W.v2.copy(h),W.v3.copy(c)}else if(r instanceof THREE.Face4){if(a=N[r.a],h=N[r.b],c=N[r.c],l=N[r.d],!(a.visible&&h.visible&&c.visible&&l.visible)||!E.doubleSided&&E.flipSided==((l.positionScreen.x-a.positionScreen.x)*(h.positionScreen.y-a.positionScreen.y)-(l.positionScreen.y-a.positionScreen.y)*(h.positionScreen.x-a.positionScreen.x)<0||(h.positionScreen.x-c.positionScreen.x)*(l.positionScreen.y-c.positionScreen.y)-(h.positionScreen.y-c.positionScreen.y)*(l.positionScreen.x-c.positionScreen.x)<0))continue;T=I[A]=I[A]||new THREE.RenderableFace4,A++,(W=T).v1.copy(a),W.v2.copy(h),W.v3.copy(c),W.v4.copy(l)}for(W.normalWorld.copy(r.normal),u.multiplyVector3(W.normalWorld),W.centroidWorld.copy(r.centroid),p.multiplyVector3(W.centroidWorld),W.centroidScreen.copy(W.centroidWorld),X.multiplyVector3(W.centroidScreen),a=0,h=(c=r.vertexNormals).length;a<h;a++)(l=W.vertexNormalsWorld[a]).copy(c[a]),u.multiplyVector3(l);for(a=0,h=R.length;a<h;a++)if(T=R[a][s])for(c=0,l=T.length;c<l;c++)W.uvs[a][c]=T[c];W.material=d,W.faceMaterial=null!==r.materialIndex?f[r.materialIndex]:null,W.z=W.centroidScreen.z,U.elements.push(W)}}else if(E instanceof THREE.Line)for(G.multiply(X,p),s=E.geometry.vertices,(a=V()).positionScreen.copy(s[0].position),G.multiplyVector4(a.positionScreen),o=1,r=s.length;o<r;o++)(a=V()).positionScreen.copy(s[o].position),G.multiplyVector4(a.positionScreen),h=N[j-2],Z.copy(a.positionScreen),Q.copy(h.positionScreen),y=Q,H=x=void 0,x=0,H=1,v=(g=Z).z+g.w,w=y.z+y.w,M=-g.z+g.w,b=-y.z+y.w,(0<=v&&0<=w&&0<=M&&0<=b||!(v<0&&w<0||M<0&&b<0)&&(v<0?x=Math.max(x,v/(v-w)):w<0&&(H=Math.min(H,v/(v-w))),M<0?x=Math.max(x,M/(M-b)):b<0&&(H=Math.min(H,M/(M-b))),!(H<x)&&(g.lerpSelf(y,x),y.lerpSelf(g,1-H),1)))&&(Z.multiplyScalar(1/Z.w),Q.multiplyScalar(1/Q.w),E=k[O]=k[O]||new THREE.RenderableLine,O++,(B=E).v1.positionScreen.copy(Z),B.v2.positionScreen.copy(Q),B.z=Math.max(Z.z,Q.z),B.material=d,U.elements.push(B));for(t=0,n=U.sprites.length;t<n;t++)p=(E=U.sprites[t].object).matrixWorld,E instanceof THREE.Particle&&(q.set(p.n14,p.n24,p.n34,1),X.multiplyVector4(q),q.z/=q.w,0<q.z&&q.z<1)&&(S=Y[F]=Y[F]||new THREE.RenderableParticle,F++,(D=S).x=q.x/q.w,D.y=q.y/q.w,D.z=q.z,D.rotation=E.rotation.z,D.scale.x=E.scale.x*Math.abs(D.x-(q.x+i.projectionMatrix.n11)/(q.w+i.projectionMatrix.n14)),D.scale.y=E.scale.y*Math.abs(D.y-(q.y+i.projectionMatrix.n22)/(q.w+i.projectionMatrix.n24)),D.material=E.material,U.elements.push(D));return e&&U.elements.sort(C),U}},THREE.Quaternion=function(t,i,e,n){this.set(t||0,i||0,e||0,void 0!==n?n:1)},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEuler:function(t){var i=Math.PI/360,e=t.x*i,n=t.y*i,o=t.z*i,r=(t=Math.cos(n),n=Math.sin(n),i=Math.cos(-o),o=Math.sin(-o),Math.cos(e)),s=(e=Math.sin(e),t*i),a=n*o;return this.w=s*r-a*e,this.x=s*e+a*r,this.y=n*i*r+t*o*e,this.z=t*o*r-n*i*e,this},setFromAxisAngle:function(t,i){var e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this},setFromRotationMatrix:function(t){var i=Math.pow(t.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,i+t.n11+t.n22+t.n33))/2,this.x=Math.sqrt(Math.max(0,i+t.n11-t.n22-t.n33))/2,this.y=Math.sqrt(Math.max(0,i-t.n11+t.n22-t.n33))/2,this.z=Math.sqrt(Math.max(0,i-t.n11-t.n22+t.n33))/2,this.x=t.n32-t.n23<0?-Math.abs(this.x):Math.abs(this.x),this.y=t.n13-t.n31<0?-Math.abs(this.y):Math.abs(this.y),this.z=t.n21-t.n12<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?this.w=this.z=this.y=this.x=0:(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},multiplySelf:function(t){var i=this.x,e=this.y,n=this.z,o=this.w,r=t.x,s=t.y,a=t.z;t=t.w;return this.x=i*t+o*r+e*a-n*s,this.y=e*t+o*s+n*r-i*a,this.z=n*t+o*a+i*s-e*r,this.w=o*t-i*r-e*s-n*a,this},multiply:function(t,i){return this.x=t.x*i.w+t.y*i.z-t.z*i.y+t.w*i.x,this.y=-t.x*i.z+t.y*i.w+t.z*i.x+t.w*i.y,this.z=t.x*i.y-t.y*i.x+t.z*i.w+t.w*i.z,this.w=-t.x*i.x-t.y*i.y-t.z*i.z+t.w*i.w,this},multiplyVector3:function(t,i){i||(i=t);var e=t.x,n=t.y,o=t.z,r=this.x,s=this.y,a=this.z,h=this.w,c=h*e+s*o-a*n,l=h*n+a*e-r*o,E=h*o+r*n-s*e;e=-r*e-s*n-a*o;return i.x=c*h+e*-r+l*-a-E*-s,i.y=l*h+e*-s+E*-r-c*-a,i.z=E*h+e*-a+c*-s-l*-r,i}},THREE.Quaternion.slerp=function(t,i,e,n){if((r=t.w*i.w+t.x*i.x+t.y*i.y+t.z*i.z)<0?(e.w=-i.w,e.x=-i.x,e.y=-i.y,e.z=-i.z,r=-r):e.copy(i),1<=Math.abs(r))return e.w=t.w,e.x=t.x,e.y=t.y,e.z=t.z,e;var o=Math.acos(r),r=Math.sqrt(1-r*r);return Math.abs(r)<.001?(e.w=.5*(t.w+i.w),e.x=.5*(t.x+i.x),e.y=.5*(t.y+i.y),e.z=.5*(t.z+i.z)):(i=Math.sin((1-n)*o)/r,n=Math.sin(n*o)/r,e.w=t.w*i+e.w*n,e.x=t.x*i+e.x*n,e.y=t.y*i+e.y*n,e.z=t.z*i+e.z*n),e},THREE.Vertex=function(t){this.position=t||new THREE.Vector3},THREE.Face3=function(t,i,e,n,o,r){this.a=t,this.b=i,this.c=e,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=r,this.centroid=new THREE.Vector3},THREE.Face4=function(t,i,e,n,o,r,s){this.a=t,this.b=i,this.c=e,this.d=n,this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3,this.vertexNormals=o instanceof Array?o:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=s,this.centroid=new THREE.Vector3},THREE.UV=function(t,i){this.u=t||0,this.v=i||0},THREE.UV.prototype={constructor:THREE.UV,set:function(t,i){return this.u=t,this.v=i,this},copy:function(t){return this.u=t.u,this.v=t.v,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(t){var i=new THREE.Matrix4;i.extractRotation(t,new THREE.Vector3(1,1,1));for(var e=0,n=this.vertices.length;e<n;e++)t.multiplyVector3(this.vertices[e].position);for(e=0,n=this.faces.length;e<n;e++){var o=this.faces[e];i.multiplyVector3(o.normal);for(var r=0,s=o.vertexNormals.length;r<s;r++)i.multiplyVector3(o.vertexNormals[r]);t.multiplyVector3(o.centroid)}},computeCentroids:function(){var t,i,e;for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t]).centroid.set(0,0,0),e instanceof THREE.Face3?(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.divideScalar(3)):e instanceof THREE.Face4&&(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.addSelf(this.vertices[e.d].position),e.centroid.divideScalar(4))},computeFaceNormals:function(){var t,i,e,n,o,r,s=new THREE.Vector3,a=new THREE.Vector3;for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],n=this.vertices[e.a],o=this.vertices[e.b],r=this.vertices[e.c],s.sub(r.position,o.position),a.sub(n.position,o.position),s.crossSelf(a),s.isZero()||s.normalize(),e.normal.copy(s)},computeVertexNormals:function(){var t,i,e,n;if(void 0===this.__tmpVertices){for(n=this.__tmpVertices=Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)n[t]=new THREE.Vector3;for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t])instanceof THREE.Face3?e.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:e instanceof THREE.Face4&&(e.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(n=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)n[t].set(0,0,0);for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t])instanceof THREE.Face3?(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal)):e instanceof THREE.Face4&&(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal),n[e.d].addSelf(e.normal));for(t=0,i=this.vertices.length;t<i;t++)n[t].normalize();for(t=0,i=this.faces.length;t<i;t++)(e=this.faces[t])instanceof THREE.Face3?(e.vertexNormals[0].copy(n[e.a]),e.vertexNormals[1].copy(n[e.b]),e.vertexNormals[2].copy(n[e.c])):e instanceof THREE.Face4&&(e.vertexNormals[0].copy(n[e.a]),e.vertexNormals[1].copy(n[e.b]),e.vertexNormals[2].copy(n[e.c]),e.vertexNormals[3].copy(n[e.d]))},computeTangents:function(){function t(t,i,e,n,o,r,s){h=t.vertices[i].position,c=t.vertices[e].position,l=t.vertices[n].position,E=a[o],p=a[r],u=a[s],d=c.x-h.x,f=l.x-h.x,m=c.y-h.y,R=l.y-h.y,T=c.z-h.z,g=l.z-h.z,y=p.u-E.u,x=u.u-E.u,H=p.v-E.v,v=u.v-E.v,w=1/(y*v-x*H),S.set((v*d-H*f)*w,(v*m-H*R)*w,(v*T-H*g)*w),z.set((y*f-x*d)*w,(y*R-x*m)*w,(y*g-x*T)*w),M[i].addSelf(S),M[e].addSelf(S),M[n].addSelf(S),b[i].addSelf(z),b[e].addSelf(z),b[n].addSelf(z)}var i,e,n,o,r,a,h,c,l,E,p,u,d,f,m,R,T,g,y,x,H,v,w,s,M=[],b=[],S=new THREE.Vector3,z=new THREE.Vector3,V=new THREE.Vector3,C=new THREE.Vector3,L=new THREE.Vector3;for(i=0,e=this.vertices.length;i<e;i++)M[i]=new THREE.Vector3,b[i]=new THREE.Vector3;for(i=0,e=this.faces.length;i<e;i++)r=this.faces[i],a=this.faceVertexUvs[0][i],r instanceof THREE.Face3?t(this,r.a,r.b,r.c,0,1,2):r instanceof THREE.Face4&&(t(this,r.a,r.b,r.c,0,1,2),t(this,r.a,r.b,r.d,0,1,3));var j=["a","b","c","d"];for(i=0,e=this.faces.length;i<e;i++)for(r=this.faces[i],n=0;n<r.vertexNormals.length;n++)L.copy(r.vertexNormals[n]),o=r[j[n]],s=M[o],V.copy(s),V.subSelf(L.multiplyScalar(L.dot(s))).normalize(),C.cross(r.vertexNormals[n],s),o=(o=C.dot(b[o]))<0?-1:1,r.vertexTangents[n]=new THREE.Vector4(V.x,V.y,V.z,o);this.hasTangents=!0},computeBoundingBox:function(){var t;if(0<this.vertices.length){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var i=1,e=this.vertices.length;i<e;i++)(t=this.vertices[i]).position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=t.position.x:t.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=t.position.x),t.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=t.position.y:t.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=t.position.y),t.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=t.position.z:t.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=t.position.z)}},computeBoundingSphere:function(){for(var t=0,i=0,e=this.vertices.length;i<e;i++)t=Math.max(t,this.vertices[i].position.length());this.boundingSphere={radius:t}},mergeVertices:function(){var t,i,e,n={},o=[],r=[],s=Math.pow(10,4);for(i=0,e=this.vertices.length;i<e;i++)t=this.vertices[i].position,void 0===n[t=[Math.round(t.x*s),Math.round(t.y*s),Math.round(t.z*s)].join("_")]?(n[t]=i,o.push(this.vertices[i]),r[i]=o.length-1):r[i]=r[n[t]];for(i=0,e=this.faces.length;i<e;i++)(n=this.faces[i])instanceof THREE.Face3?(n.a=r[n.a],n.b=r[n.b],n.c=r[n.c]):n instanceof THREE.Face4&&(n.a=r[n.a],n.b=r[n.b],n.c=r[n.c],n.d=r[n.d]);this.vertices=o}},THREE.GeometryCount=0,THREE.Camera=function(){if(arguments.length)return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3]);THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(t){this.matrix.lookAt(this.position,t,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},THREE.OrthographicCamera=function(t,i,e,n,o,r){THREE.Camera.call(this),this.left=t,this.right=i,this.top=e,this.bottom=n,this.near=void 0!==o?o:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(t,i,e,n){THREE.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==i?i:1,this.near=void 0!==e?e:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(t,i){this.fov=2*Math.atan((void 0!==i?i:43.25)/(2*t)),this.fov*=180/Math.PI,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(t,i,e,n,o,r){this.fullWidth=t,this.fullHeight=i,this.x=e,this.y=n,this.width=o,this.height=r,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(this.fov*Math.PI/360)*this.near,e=t*(n=-i),n=(t=Math.abs(t*i-e),Math.abs(i-n));this.projectionMatrix=THREE.Matrix4.makeFrustum(e+this.x*t/this.fullWidth,e+(this.x+this.width)*t/this.fullWidth,i-(this.y+this.height)*n/this.fullHeight,i-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(t){THREE.Object3D.call(this),this.color=new THREE.Color(t)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(t){THREE.Light.call(this,t)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(t,i,e){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,1,0),this.intensity=void 0!==i?i:1,this.distance=void 0!==e?e:0},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(t,i,e){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,0,0),this.intensity=void 0!==i?i:1,this.distance=void 0!==e?e:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.Material=function(t){this.name="",this.id=THREE.MaterialCount++,t=t||{},this.opacity=void 0!==t.opacity?t.opacity:1,this.transparent=void 0!==t.transparent&&t.transparent,this.blending=void 0!==t.blending?t.blending:THREE.NormalBlending,this.depthTest=void 0===t.depthTest||t.depthTest,this.depthWrite=void 0===t.depthWrite||t.depthWrite,this.polygonOffset=void 0!==t.polygonOffset&&t.polygonOffset,this.polygonOffsetFactor=void 0!==t.polygonOffsetFactor?t.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==t.polygonOffsetUnits?t.polygonOffsetUnits:0,this.alphaTest=void 0!==t.alphaTest?t.alphaTest:0,this.overdraw=void 0!==t.overdraw&&t.overdraw},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.MultiplyBlending=3,THREE.AdditiveAlphaBlending=4,THREE.LineBasicMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(16777215),this.linewidth=void 0!==t.linewidth?t.linewidth:1,this.linecap=void 0!==t.linecap?t.linecap:"round",this.linejoin=void 0!==t.linejoin?t.linejoin:"round",this.vertexColors=!!t.vertexColors&&t.vertexColors,this.fog=void 0===t.fog||t.fog},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(16777215),this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0===t.fog||t.fog,this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.skinning=void 0!==t.skinning&&t.skinning,this.morphTargets=void 0!==t.morphTargets&&t.morphTargets},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(16777215),this.ambient=void 0!==t.ambient?new THREE.Color(t.ambient):new THREE.Color(328965),this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0===t.fog||t.fog,this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.skinning=void 0!==t.skinning&&t.skinning,this.morphTargets=void 0!==t.morphTargets&&t.morphTargets},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(16777215),this.ambient=void 0!==t.ambient?new THREE.Color(t.ambient):new THREE.Color(328965),this.specular=void 0!==t.specular?new THREE.Color(t.specular):new THREE.Color(1118481),this.shininess=void 0!==t.shininess?t.shininess:30,this.metal=void 0!==t.metal&&t.metal,this.perPixel=void 0!==t.perPixel&&t.perPixel,this.map=void 0!==t.map?t.map:null,this.lightMap=void 0!==t.lightMap?t.lightMap:null,this.envMap=void 0!==t.envMap?t.envMap:null,this.combine=void 0!==t.combine?t.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==t.reflectivity?t.reflectivity:1,this.refractionRatio=void 0!==t.refractionRatio?t.refractionRatio:.98,this.fog=void 0===t.fog||t.fog,this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1,this.wireframeLinecap=void 0!==t.wireframeLinecap?t.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==t.wireframeLinejoin?t.wireframeLinejoin:"round",this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.skinning=void 0!==t.skinning&&t.skinning,this.morphTargets=void 0!==t.morphTargets&&t.morphTargets},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.shading=void 0!==t.shading?t.shading:THREE.SmoothShading,this.wireframe=void 0!==t.wireframe&&t.wireframe,this.wireframeLinewidth=void 0!==t.wireframeLinewidth?t.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.shading=t.shading?t.shading:THREE.FlatShading,this.wireframe=!!t.wireframe&&t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth?t.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.ParticleBasicMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(16777215),this.map=void 0!==t.map?t.map:null,this.size=void 0!==t.size?t.size:1,this.sizeAttenuation=void 0===t.sizeAttenuation||t.sizeAttenuation,this.vertexColors=void 0!==t.vertexColors&&t.vertexColors,this.fog=void 0===t.fog||t.fog},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(t){THREE.Material.call(this,t),t=t||{},this.color=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(16777215),this.program=void 0!==t.program?t.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.Texture=function(t,i,e,n,o,r){this.id=THREE.TextureCount++,this.image=t,this.mapping=void 0!==i?i:new THREE.UVMapping,this.wrapS=void 0!==e?e:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:THREE.LinearFilter,this.minFilter=void 0!==r?r:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var t=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return t.offset.copy(this.offset),t.repeat.copy(this.repeat),t}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.Particle=function(t){THREE.Object3D.call(this),this.material=t},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.Line=function(t,i,e){THREE.Object3D.call(this),this.geometry=t,this.material=i,this.type=void 0!==e?e:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(t,i){if(THREE.Object3D.call(this),this.geometry=t,(this.material=i)instanceof Array&&(console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=i[0]),this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=t.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0;e<this.geometry.morphTargets.length;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)},THREE.Bone=function(t){THREE.Object3D.call(this),this.skin=t,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(t,i){this.matrixAutoUpdate&&(i|=this.updateMatrix()),(i||this.matrixWorldNeedsUpdate)&&(t?this.skinMatrix.multiply(t,this.matrix):this.skinMatrix.copy(this.matrix),i=!(this.matrixWorldNeedsUpdate=!1));var e,n=this.children.length;for(e=0;e<n;e++)this.children[e].update(this.skinMatrix,i)},THREE.Sprite=function(t){THREE.Object3D.call(this),this.color=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(16777215),this.map=t.map instanceof THREE.Texture?t.map:THREE.ImageUtils.loadTexture(t.map),this.blending=void 0!==t.blending?t.blending:THREE.NormalBlending,this.useScreenCoordinates=void 0===t.useScreenCoordinates||t.useScreenCoordinates,this.mergeWith3D=void 0!==t.mergeWith3D?t.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==t.affectedByDistance?t.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==t.scaleByViewport?t.scaleByViewport:!this.affectedByDistance,this.alignment=t.alignment instanceof THREE.Vector2?t.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.objects=[],this.lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.addObject=function(t){if(t instanceof THREE.Light)-1===this.lights.indexOf(t)&&this.lights.push(t);else if(!(t instanceof THREE.Camera||t instanceof THREE.Bone)&&-1===this.objects.indexOf(t)){this.objects.push(t),this.__objectsAdded.push(t);var i=this.__objectsRemoved.indexOf(t);-1!==i&&this.__objectsRemoved.splice(i,1)}for(i=0;i<t.children.length;i++)this.addObject(t.children[i])},THREE.Scene.prototype.removeObject=function(t){if(t instanceof THREE.Light){var i=this.lights.indexOf(t);-1!==i&&this.lights.splice(i,1)}else t instanceof THREE.Camera||-1!==(i=this.objects.indexOf(t))&&(this.objects.splice(i,1),this.__objectsRemoved.push(t),-1!==(i=this.__objectsAdded.indexOf(t))&&this.__objectsAdded.splice(i,1));for(i=0;i<t.children.length;i++)this.removeObject(t.children[i])},THREE.CanvasRenderer=function(t){function D(t){a!=t&&(St.globalAlpha=a=t)}function F(t){if(h!=t){switch(t){case THREE.NormalBlending:St.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:St.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:St.globalCompositeOperation="darker"}h=t}}function N(t){c!=t&&(St.strokeStyle=c=t)}function _(t){l!=t&&(St.fillStyle=l=t)}var I,k,Y,e,n,U,q,X,G,Z,Q,$,J,K,tt,it,et,nt,ot,rt,st,at,ht,ct,lt,Et,pt,ut,dt,ft,mt,Rt,Tt,gt,yt,xt,Ht,vt,wt,Mt=this,bt=new THREE.Projector,o=void 0!==(t=t||{}).canvas?t.canvas:document.createElement("canvas"),St=o.getContext("2d"),r=new THREE.Color(0),s=0,a=1,h=0,c=null,l=null,zt=null,Vt=null,Ct=null,Lt=new THREE.RenderableVertex,jt=new THREE.RenderableVertex,Wt=new THREE.Color,Pt=new THREE.Color,At=new THREE.Color,Bt=new THREE.Color,Ot=new THREE.Color,Dt=[],Ft=[],Nt=new THREE.Rectangle,_t=new THREE.Rectangle,It=new THREE.Rectangle,kt=!1,Yt=new THREE.Color,Ut=new THREE.Color,qt=new THREE.Color,Xt=new THREE.Vector3;t=16;(gt=document.createElement("canvas")).width=gt.height=2,(yt=gt.getContext("2d")).fillStyle="rgba(0,0,0,1)",yt.fillRect(0,0,2,2),xt=yt.getImageData(0,0,2,2),Ht=xt.data,(vt=document.createElement("canvas")).width=vt.height=t,(wt=vt.getContext("2d")).translate(-t/2,-t/2),wt.scale(t,t),t--,this.domElement=o,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(t,i){e=t,n=i,U=Math.floor(e/2),q=Math.floor(n/2),o.width=e,o.height=n,Nt.set(-U,-q,U,q),_t.set(-U,-q,U,q),a=1,h=0,Ct=Vt=zt=l=c=null},this.setClearColor=function(t,i){r.copy(t),s=i,_t.set(-U,-q,U,q)},this.setClearColorHex=function(t,i){r.setHex(t),s=i,_t.set(-U,-q,U,q)},this.clear=function(){St.setTransform(1,0,0,-1,U,q),_t.isEmpty()||(_t.minSelf(Nt),_t.inflate(2),s<1&&St.clearRect(Math.floor(_t.getX()),Math.floor(_t.getY()),Math.floor(_t.getWidth()),Math.floor(_t.getHeight())),0<s&&(F(THREE.NormalBlending),D(1),_("rgba("+Math.floor(255*r.r)+","+Math.floor(255*r.g)+","+Math.floor(255*r.b)+","+s+")"),St.fillRect(Math.floor(_t.getX()),Math.floor(_t.getY()),Math.floor(_t.getWidth()),Math.floor(_t.getHeight()))),_t.empty())},this.render=function(t,h){function c(t,i,e,n){var o,r,s,a,h,c;for(o=0,r=t.length;o<r;o++)a=(s=t[o]).color,s instanceof THREE.DirectionalLight?(h=s.matrixWorld.getPosition(),(c=e.dot(h))<=0||(c*=s.intensity,n.r+=a.r*c,n.g+=a.g*c,n.b+=a.b*c)):s instanceof THREE.PointLight&&(h=s.matrixWorld.getPosition(),(c=e.dot(Xt.sub(h,i).normalize()))<=0||0!=(c*=0==s.distance?1:1-Math.min(i.distanceTo(h)/s.distance,1))&&(c*=s.intensity,n.r+=a.r*c,n.g+=a.g*c,n.b+=a.b*c))}function i(t,i,e,n,o,r,s,a){Mt.info.render.vertices+=3,Mt.info.render.faces++,D(a.opacity),F(a.blending),$=t.positionScreen.x,J=t.positionScreen.y,K=i.positionScreen.x,tt=i.positionScreen.y,it=e.positionScreen.x,et=e.positionScreen.y,l($,J,K,tt,it,et),a instanceof THREE.MeshBasicMaterial?a.map?a.map.mapping instanceof THREE.UVMapping&&(pt=s.uvs[0],p($,J,K,tt,it,et,pt[n].u,pt[n].v,pt[o].u,pt[o].v,pt[r].u,pt[r].v,a.map)):a.envMap?a.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(t=h.matrixWorldInverse,Xt.copy(s.vertexNormalsWorld[n]),ut=.5*(Xt.x*t.n11+Xt.y*t.n12+Xt.z*t.n13)+.5,dt=.5*-(Xt.x*t.n21+Xt.y*t.n22+Xt.z*t.n23)+.5,Xt.copy(s.vertexNormalsWorld[o]),ft=.5*(Xt.x*t.n11+Xt.y*t.n12+Xt.z*t.n13)+.5,mt=.5*-(Xt.x*t.n21+Xt.y*t.n22+Xt.z*t.n23)+.5,Xt.copy(s.vertexNormalsWorld[r]),Rt=.5*(Xt.x*t.n11+Xt.y*t.n12+Xt.z*t.n13)+.5,Tt=.5*-(Xt.x*t.n21+Xt.y*t.n22+Xt.z*t.n23)+.5,p($,J,K,tt,it,et,ut,dt,ft,mt,Rt,Tt,a.envMap)):a.wireframe?E(a.color,a.wireframeLinewidth,a.wireframeLinecap,a.wireframeLinejoin):R(a.color):a instanceof THREE.MeshLambertMaterial?(a.map&&!a.wireframe&&(a.map.mapping instanceof THREE.UVMapping&&(pt=s.uvs[0],p($,J,K,tt,it,et,pt[n].u,pt[n].v,pt[o].u,pt[o].v,pt[r].u,pt[r].v,a.map)),F(THREE.SubtractiveBlending)),kt?a.wireframe||a.shading!=THREE.SmoothShading||3!=s.vertexNormalsWorld.length?(Wt.r=Yt.r,Wt.g=Yt.g,Wt.b=Yt.b,c(Y,s.centroidWorld,s.normalWorld,Wt),Wt.r=Math.max(0,Math.min(a.color.r*Wt.r,1)),Wt.g=Math.max(0,Math.min(a.color.g*Wt.g,1)),Wt.b=Math.max(0,Math.min(a.color.b*Wt.b,1)),a.wireframe?E(Wt,a.wireframeLinewidth,a.wireframeLinecap,a.wireframeLinejoin):R(Wt)):(Pt.r=At.r=Bt.r=Yt.r,Pt.g=At.g=Bt.g=Yt.g,Pt.b=At.b=Bt.b=Yt.b,c(Y,s.v1.positionWorld,s.vertexNormalsWorld[0],Pt),c(Y,s.v2.positionWorld,s.vertexNormalsWorld[1],At),c(Y,s.v3.positionWorld,s.vertexNormalsWorld[2],Bt),Pt.r=Math.max(0,Math.min(a.color.r*Pt.r,1)),Pt.g=Math.max(0,Math.min(a.color.g*Pt.g,1)),Pt.b=Math.max(0,Math.min(a.color.b*Pt.b,1)),At.r=Math.max(0,Math.min(a.color.r*At.r,1)),At.g=Math.max(0,Math.min(a.color.g*At.g,1)),At.b=Math.max(0,Math.min(a.color.b*At.b,1)),Bt.r=Math.max(0,Math.min(a.color.r*Bt.r,1)),Bt.g=Math.max(0,Math.min(a.color.g*Bt.g,1)),Bt.b=Math.max(0,Math.min(a.color.b*Bt.b,1)),Ot.r=.5*(At.r+Bt.r),Ot.g=.5*(At.g+Bt.g),Ot.b=.5*(At.b+Bt.b),Et=d(Pt,At,Bt,Ot),u($,J,K,tt,it,et,0,0,1,0,0,1,Et)):a.wireframe?E(a.color,a.wireframeLinewidth,a.wireframeLinecap,a.wireframeLinejoin):R(a.color)):a instanceof THREE.MeshDepthMaterial?(ct=h.near,lt=h.far,Pt.r=Pt.g=Pt.b=1-f(t.positionScreen.z,ct,lt),At.r=At.g=At.b=1-f(i.positionScreen.z,ct,lt),Bt.r=Bt.g=Bt.b=1-f(e.positionScreen.z,ct,lt),Ot.r=.5*(At.r+Bt.r),Ot.g=.5*(At.g+Bt.g),Ot.b=.5*(At.b+Bt.b),Et=d(Pt,At,Bt,Ot),u($,J,K,tt,it,et,0,0,1,0,0,1,Et)):a instanceof THREE.MeshNormalMaterial&&(Wt.r=m(s.normalWorld.x),Wt.g=m(s.normalWorld.y),Wt.b=m(s.normalWorld.z),a.wireframe?E(Wt,a.wireframeLinewidth,a.wireframeLinecap,a.wireframeLinejoin):R(Wt))}function l(t,i,e,n,o,r){St.beginPath(),St.moveTo(t,i),St.lineTo(e,n),St.lineTo(o,r),St.lineTo(t,i),St.closePath()}function e(t,i,e,n,o,r,s,a){St.beginPath(),St.moveTo(t,i),St.lineTo(e,n),St.lineTo(o,r),St.lineTo(s,a),St.lineTo(t,i),St.closePath()}function E(t,i,e,n){zt!=i&&(St.lineWidth=zt=i),Vt!=e&&(St.lineCap=Vt=e),Ct!=n&&(St.lineJoin=Ct=n),N(t.getContextStyle()),St.stroke(),It.inflate(2*i)}function R(t){_(t.getContextStyle()),St.fill()}function p(t,i,e,n,o,r,s,a,h,c,l,E,p){if(0!=p.image.width){if(1==p.needsUpdate||null==Dt[p.id]){var u=p.wrapS==THREE.RepeatWrapping,d=p.wrapT==THREE.RepeatWrapping;Dt[p.id]=St.createPattern(p.image,u&&d?"repeat":u&&!d?"repeat-x":!u&&d?"repeat-y":"no-repeat"),p.needsUpdate=!1}_(Dt[p.id]);u=p.offset.x/p.repeat.x,d=p.offset.y/p.repeat.y;var f=p.image.width*p.repeat.x,m=p.image.height*p.repeat.y;h=(h+u)*f,c=(c+d)*m,l=(l+u)*f,E=(E+d)*m;e-=t,n-=i,o-=t,r-=i,0==(u=(h-=s=(s+u)*f)*(E-=a=(a+d)*m)-(l-=s)*(c-=a))?(null==Ft[p.id]&&((i=document.createElement("canvas")).width=p.image.width,i.height=p.image.height,(t=i.getContext("2d")).drawImage(p.image,0,0),Ft[p.id]=t.getImageData(0,0,p.image.width,p.image.height).data,delete i),i=Ft[p.id],s=4*(Math.floor(s)+Math.floor(a)*p.image.width),Wt.setRGB(i[s]/255,i[s+1]/255,i[s+2]/255),R(Wt)):(t=t-(p=(E*e-c*o)*(u=1/u))*s-(e=(h*o-l*e)*u)*a,s=i-(c=(E*n-c*r)*u)*s-(n=(h*r-l*n)*u)*a,St.save(),St.transform(p,c,e,n,t,s),St.fill(),St.restore())}}function u(t,i,e,n,o,r,s,a,h,c,l,E,p){var u,d;h*=u=p.width-1,c*=d=p.height-1,l*=u,E*=d,t=t-(u=((E-=a*=d)*(e-=t)-(c-=a)*(o-=t))*(d=1/((h-=s*=u)*E-(l-=s)*c)))*s-(e=(h*o-l*e)*d)*a,i=i-(c=(E*(n-=i)-c*(r-=i))*d)*s-(n=(h*r-l*n)*d)*a,St.save(),St.transform(u,c,e,n,t,i),St.clip(),St.drawImage(p,0,0),St.restore()}function d(t,i,e,n){var o=~~(255*t.r),r=~~(255*t.g),s=(t=~~(255*t.b),~~(255*i.r)),a=~~(255*i.g),h=(i=~~(255*i.b),~~(255*e.r)),c=~~(255*e.g),l=(e=~~(255*e.b),~~(255*n.r)),E=~~(255*n.g);n=~~(255*n.b);return Ht[0]=o<0?0:255<o?255:o,Ht[1]=r<0?0:255<r?255:r,Ht[2]=t<0?0:255<t?255:t,Ht[4]=s<0?0:255<s?255:s,Ht[5]=a<0?0:255<a?255:a,Ht[6]=i<0?0:255<i?255:i,Ht[8]=h<0?0:255<h?255:h,Ht[9]=c<0?0:255<c?255:c,Ht[10]=e<0?0:255<e?255:e,Ht[12]=l<0?0:255<l?255:l,Ht[13]=E<0?0:255<E?255:E,Ht[14]=n<0?0:255<n?255:n,yt.putImageData(xt,0,0),wt.drawImage(gt,0,0),vt}function f(t,i,e){return(t=(t-i)/(e-i))*t*(3-2*t)}function m(t){return(t=.5*(t+1))<0?0:1<t?1:t}function n(t,i){var e=i.x-t.x,n=i.y-t.y,o=e*e+n*n;0!=o&&(e*=o=1/Math.sqrt(o),n*=o,i.x+=e,i.y+=n,t.x-=e,t.y-=n)}var o,r,s,a,T,g,y,x,H,v,w,M,b,S,z,V,C,L,j,W,P,A,B,O;for(this.autoClear?this.clear():St.setTransform(1,0,0,-1,U,q),Mt.info.render.vertices=0,Mt.info.render.faces=0,I=bt.projectScene(t,h,this.sortElements),k=I.elements,Y=I.lights,(kt=0<Y.length)&&function(t){var i,e,n,o;for(Yt.setRGB(0,0,0),Ut.setRGB(0,0,0),qt.setRGB(0,0,0),i=0,e=t.length;i<e;i++)o=(n=t[i]).color,n instanceof THREE.AmbientLight?(Yt.r+=o.r,Yt.g+=o.g,Yt.b+=o.b):n instanceof THREE.DirectionalLight?(Ut.r+=o.r,Ut.g+=o.g,Ut.b+=o.b):n instanceof THREE.PointLight&&(qt.r+=o.r,qt.g+=o.g,qt.b+=o.b)}(Y),o=0,r=k.length;o<r;o++)null!=(a=(a=(s=k[o]).material)instanceof THREE.MeshFaceMaterial?s.faceMaterial:a)&&0!=a.opacity&&(It.empty(),s instanceof THREE.RenderableParticle?((X=s).x*=U,X.y*=q,V=X,C=s,O=B=A=P=W=j=void 0,D((L=a).opacity),F(L.blending),L instanceof THREE.ParticleBasicMaterial?L.map&&(B=(A=L.map.image).width>>1,O=A.height>>1,j=(L=C.scale.x*U)*B,W=(P=C.scale.y*q)*O,It.set(V.x-j,V.y-W,V.x+j,V.y+W),Nt.intersects(It)&&(St.save(),St.translate(V.x,V.y),St.rotate(-C.rotation),St.scale(L,-P),St.translate(-B,-O),St.drawImage(A,0,0),St.restore())):L instanceof THREE.ParticleCanvasMaterial&&(j=C.scale.x*U,W=C.scale.y*q,It.set(V.x-j,V.y-W,V.x+j,V.y+W),Nt.intersects(It)&&(N(L.color.getContextStyle()),_(L.color.getContextStyle()),St.save(),St.translate(V.x,V.y),St.rotate(-C.rotation),St.scale(j,W),L.program(St),St.restore()))):s instanceof THREE.RenderableLine?(X=s.v1,G=s.v2,X.positionScreen.x*=U,X.positionScreen.y*=q,G.positionScreen.x*=U,G.positionScreen.y*=q,It.addPoint(X.positionScreen.x,X.positionScreen.y),It.addPoint(G.positionScreen.x,G.positionScreen.y),Nt.intersects(It)&&(b=X,S=G,D((z=a).opacity),F(z.blending),St.beginPath(),St.moveTo(b.positionScreen.x,b.positionScreen.y),St.lineTo(S.positionScreen.x,S.positionScreen.y),St.closePath(),z instanceof THREE.LineBasicMaterial&&(b=z.linewidth,zt!=b&&(St.lineWidth=zt=b),b=z.linecap,Vt!=b&&(St.lineCap=Vt=b),b=z.linejoin,Ct!=b&&(St.lineJoin=Ct=b),N(z.color.getContextStyle()),St.stroke(),It.inflate(2*z.linewidth)))):s instanceof THREE.RenderableFace3?(X=s.v1,G=s.v2,Z=s.v3,X.positionScreen.x*=U,X.positionScreen.y*=q,G.positionScreen.x*=U,G.positionScreen.y*=q,Z.positionScreen.x*=U,Z.positionScreen.y*=q,a.overdraw&&(n(X.positionScreen,G.positionScreen),n(G.positionScreen,Z.positionScreen),n(Z.positionScreen,X.positionScreen)),It.add3Points(X.positionScreen.x,X.positionScreen.y,G.positionScreen.x,G.positionScreen.y,Z.positionScreen.x,Z.positionScreen.y),Nt.intersects(It)&&i(X,G,Z,0,1,2,s,a)):s instanceof THREE.RenderableFace4&&(X=s.v1,G=s.v2,Z=s.v3,Q=s.v4,X.positionScreen.x*=U,X.positionScreen.y*=q,G.positionScreen.x*=U,G.positionScreen.y*=q,Z.positionScreen.x*=U,Z.positionScreen.y*=q,Q.positionScreen.x*=U,Q.positionScreen.y*=q,Lt.positionScreen.copy(G.positionScreen),jt.positionScreen.copy(Q.positionScreen),a.overdraw&&(n(X.positionScreen,G.positionScreen),n(G.positionScreen,Q.positionScreen),n(Q.positionScreen,X.positionScreen),n(Z.positionScreen,Lt.positionScreen),n(Z.positionScreen,jt.positionScreen)),It.addPoint(X.positionScreen.x,X.positionScreen.y),It.addPoint(G.positionScreen.x,G.positionScreen.y),It.addPoint(Z.positionScreen.x,Z.positionScreen.y),It.addPoint(Q.positionScreen.x,Q.positionScreen.y),Nt.intersects(It)&&(T=X,g=G,y=Z,x=Q,H=Lt,v=jt,w=s,M=a,Mt.info.render.vertices+=4,Mt.info.render.faces++,D(M.opacity),F(M.blending),M.map||M.envMap?(i(T,g,x,0,1,3,w,M),i(H,y,v,1,2,3,w,M)):($=T.positionScreen.x,J=T.positionScreen.y,K=g.positionScreen.x,tt=g.positionScreen.y,it=y.positionScreen.x,et=y.positionScreen.y,nt=x.positionScreen.x,ot=x.positionScreen.y,rt=H.positionScreen.x,st=H.positionScreen.y,at=v.positionScreen.x,ht=v.positionScreen.y,M instanceof THREE.MeshBasicMaterial?(e($,J,K,tt,it,et,nt,ot),M.wireframe?E(M.color,M.wireframeLinewidth,M.wireframeLinecap,M.wireframeLinejoin):R(M.color)):M instanceof THREE.MeshLambertMaterial?kt?M.wireframe||M.shading!=THREE.SmoothShading||4!=w.vertexNormalsWorld.length?(Wt.r=Yt.r,Wt.g=Yt.g,Wt.b=Yt.b,c(Y,w.centroidWorld,w.normalWorld,Wt),Wt.r=Math.max(0,Math.min(M.color.r*Wt.r,1)),Wt.g=Math.max(0,Math.min(M.color.g*Wt.g,1)),Wt.b=Math.max(0,Math.min(M.color.b*Wt.b,1)),e($,J,K,tt,it,et,nt,ot),M.wireframe?E(Wt,M.wireframeLinewidth,M.wireframeLinecap,M.wireframeLinejoin):R(Wt)):(Pt.r=At.r=Bt.r=Ot.r=Yt.r,Pt.g=At.g=Bt.g=Ot.g=Yt.g,Pt.b=At.b=Bt.b=Ot.b=Yt.b,c(Y,w.v1.positionWorld,w.vertexNormalsWorld[0],Pt),c(Y,w.v2.positionWorld,w.vertexNormalsWorld[1],At),c(Y,w.v4.positionWorld,w.vertexNormalsWorld[3],Bt),c(Y,w.v3.positionWorld,w.vertexNormalsWorld[2],Ot),Pt.r=Math.max(0,Math.min(M.color.r*Pt.r,1)),Pt.g=Math.max(0,Math.min(M.color.g*Pt.g,1)),Pt.b=Math.max(0,Math.min(M.color.b*Pt.b,1)),At.r=Math.max(0,Math.min(M.color.r*At.r,1)),At.g=Math.max(0,Math.min(M.color.g*At.g,1)),At.b=Math.max(0,Math.min(M.color.b*At.b,1)),Bt.r=Math.max(0,Math.min(M.color.r*Bt.r,1)),Bt.g=Math.max(0,Math.min(M.color.g*Bt.g,1)),Bt.b=Math.max(0,Math.min(M.color.b*Bt.b,1)),Ot.r=Math.max(0,Math.min(M.color.r*Ot.r,1)),Ot.g=Math.max(0,Math.min(M.color.g*Ot.g,1)),Ot.b=Math.max(0,Math.min(M.color.b*Ot.b,1)),Et=d(Pt,At,Bt,Ot),l($,J,K,tt,nt,ot),u($,J,K,tt,nt,ot,0,0,1,0,0,1,Et),l(rt,st,it,et,at,ht),u(rt,st,it,et,at,ht,1,0,1,1,0,1,Et)):(e($,J,K,tt,it,et,nt,ot),M.wireframe?E(M.color,M.wireframeLinewidth,M.wireframeLinecap,M.wireframeLinejoin):R(M.color)):M instanceof THREE.MeshNormalMaterial?(Wt.r=m(w.normalWorld.x),Wt.g=m(w.normalWorld.y),Wt.b=m(w.normalWorld.z),e($,J,K,tt,it,et,nt,ot),M.wireframe?E(Wt,M.wireframeLinewidth,M.wireframeLinecap,M.wireframeLinejoin):R(Wt)):M instanceof THREE.MeshDepthMaterial&&(ct=h.near,lt=h.far,Pt.r=Pt.g=Pt.b=1-f(T.positionScreen.z,ct,lt),At.r=At.g=At.b=1-f(g.positionScreen.z,ct,lt),Bt.r=Bt.g=Bt.b=1-f(x.positionScreen.z,ct,lt),Ot.r=Ot.g=Ot.b=1-f(y.positionScreen.z,ct,lt),Et=d(Pt,At,Bt,Ot),l($,J,K,tt,nt,ot),u($,J,K,tt,nt,ot,0,0,1,0,0,1,Et),l(rt,st,it,et,at,ht),u(rt,st,it,et,at,ht,1,0,1,1,0,1,Et))))),_t.addRectangle(It));St.setTransform(1,0,0,1,0,0)}},THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},Particle3D=function(t){THREE.Particle.call(this,t),this.velocity=new THREE.Vector3(0,-2,0),this.velocity.rotateX(randomRange(-45,45)),this.velocity.rotateY(randomRange(0,360)),this.gravity=new THREE.Vector3(0,0,0),this.drag=1},Particle3D.prototype=new THREE.Particle,Particle3D.prototype.constructor=Particle3D,Particle3D.prototype.updatePhysics=function(){this.velocity.multiplyScalar(this.drag),this.velocity.addSelf(this.gravity),this.position.addSelf(this.velocity)};var TO_RADIANS=Math.PI/180;THREE.Vector3.prototype.rotateY=function(t){cosRY=Math.cos(t*TO_RADIANS),sinRY=Math.sin(t*TO_RADIANS);var i=this.z,e=this.x;this.x=e*cosRY+i*sinRY,this.z=e*-sinRY+i*cosRY},THREE.Vector3.prototype.rotateX=function(t){cosRY=Math.cos(t*TO_RADIANS),sinRY=Math.sin(t*TO_RADIANS);var i=this.z,e=this.y;this.y=e*cosRY+i*sinRY,this.z=e*-sinRY+i*cosRY},THREE.Vector3.prototype.rotateZ=function(t){cosRY=Math.cos(t*TO_RADIANS),sinRY=Math.sin(t*TO_RADIANS);var i=this.x,e=this.y;this.y=e*cosRY+i*sinRY,this.x=e*-sinRY+i*cosRY},$(function(){var container=document.querySelector(".snow-container");if(!/MSIE 6|MSIE 7|MSIE 8/.test(navigator.userAgent)){/MSIE 9|MSIE 10/.test(navigator.userAgent)&&$(container).css("height",$(window).height()).bind("click",function(){$(this).remove()});var containerWidth=$(container).width(),containerHeight=$(container).height(),particle,camera,scene,renderer,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,particles=[],particleImage=new Image;particleImage.src="http://www.s7smile.com/static/images/snow.png";var snowNum=500;init()}function init(){(camera=new THREE.PerspectiveCamera(75,containerWidth/containerHeight,1,1e4)).position.z=1e3,(scene=new THREE.Scene).add(camera),(renderer=new THREE.CanvasRenderer).setSize(containerWidth,containerHeight);for(var t=new THREE.ParticleBasicMaterial({map:new THREE.Texture(particleImage)}),i=0;i<snowNum;i++)(particle=new Particle3D(t)).position.x=2e3*Math.random()-1e3,particle.position.y=2e3*Math.random()-1e3,particle.position.z=2e3*Math.random()-1e3,particle.scale.x=particle.scale.y=1,scene.add(particle),particles.push(particle);container.appendChild(renderer.domElement),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("touchstart",onDocumentTouchStart,!1),document.addEventListener("touchmove",onDocumentTouchMove,!1),setInterval(loop,25)}function onDocumentMouseMove(t){mouseX=t.clientX-windowHalfX,mouseY=t.clientY-windowHalfY}function onDocumentTouchStart(t){1==t.touches.length&&(t.preventDefault(),mouseX=t.touches[0].pageX-windowHalfX,mouseY=t.touches[0].pageY-windowHalfY)}function onDocumentTouchMove(t){1==t.touches.length&&(t.preventDefault(),mouseX=t.touches[0].pageX-windowHalfX,mouseY=t.touches[0].pageY-windowHalfY)}function loop(){for(var i=0;i<particles.length;i++){var particle=particles[i];with(particle.updatePhysics(),particle.position)y<-1e3&&(y+=2e3),1e3<x?x-=2e3:x<-1e3&&(x+=2e3),1e3<z?z-=2e3:z<-1e3&&(z+=2e3)}camera.position.x+=.005*(mouseX-camera.position.x),camera.position.y+=.005*(-mouseY-camera.position.y),camera.lookAt(scene.position),renderer.render(scene,camera)}});